<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/font-awesome.min.css" type="text/css">  
    <link rel="stylesheet" href="../css/style.css" type="text/css">
    <title>Hardware Ecommerce</title>
</head>
<body>
<!-- Header Section Begin -->
<header class="header">
    <div class="header__top">
        <div class="container-fluid pr-5 pl-5">
            <div class="row">
                <div class="col-lg-6 col-md-6">
                    <div class="header__top__left">
                        <ul>
                            <li><i class="fa fa-envelope"></i> fayshinghardware@gmail.com</li>
                            
                        </ul>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6">
                    <div class="header__top__right">
                        <div class="header__top__right__social">
                            <a href="#"><i class="fa fa-facebook"></i></a>
                            <a href="#"><i class="fa fa-twitter"></i></a>
                            <a href="#"><i class="fa fa-linkedin"></i></a>
                            <a href="#"><i class="fa fa-pinterest-p"></i></a>
                        </div>
                        
                        <div class="header__top__right__auth">
                            <a href="/login"><i class="fa fa-user"></i> Login</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <div class="header__logo">
                   <img src="/img/logo.png" alt="">
                </div>
            </div>
            <div class="col-lg-6">
                <nav class="header__menu">
                    <ul>
                        <li ><a href="/homepage/<%= userId %>">Home</a></li>
                        <li><a href="/shop">Shop</a></li>
                        <li><a href="/pages">Pages</a>
                            <ul class="header__menu__dropdown">
                                <li><a href="/userOrder/<%= userId %>">Ordered</a></li>
                                <li><a href="/cart/<%= userId %>">Shoping Cart</a></li>
                                <li><a href="/check_out">Check Out</a></li>
                     
                            </ul>
                        </li>
                       
                        <li><a href="/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
            <div class="col-lg-3">
                <div class="header__cart">
                    <ul>
                        <li><a href="/cart/<%= userId %>"><i class="fa fa-shopping-bag"></i> </a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="humberger__open">
            <i class="fa fa-bars"></i>
        </div>
    </div>
</header>
<!-- Header Section End -->
<section class="breadcrumb-section" style="background-image: url('/img/breadcrumb.jpg'); background-repeat: no-repeat; background-size: cover; background-position: center;">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center p-5">
                <div class="breadcrumb__text">
                    <h2 style="color: aliceblue;">Your Cart</h2>
                </div>
            </div>
        </div>
    </div>
</section>
<div class="container mt-5">
    <form action="/checkout-selected/<%= userId %>" method="POST" onsubmit="return logSelectedItems();">
        <div class="row">
            <% cartProducts.forEach(item => { %>
                <div class="col-12 mb-4" >
                    <div class="card">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-1 text-center">
                                    <input type="checkbox" name="selectedItems" value="<%= item.ProductID %>" style="width: 40%;">
                                </div>
                                <!-- Product Image -->
                                <div class="col-md-2">
                                    <img class="img-fluid" src="<%= item.Picture %>" alt="Product Image" style="max-width: 100px; height: auto; object-fit: cover;">
                                </div>

                                <!-- Product Details -->
                                <div class="col-md-4">
                                    <h5 class="card-title"><%= item.ProductName %></h5>
                                    <p class="card-text">Price: $<%= Number(item.Price).toFixed(2) %></p>
                                    <p class="card-text">Total: $<span id="total-<%= item.ProductID %>"><%= (Number(item.Price) * item.Quantity).toFixed(2) %></span></p>
                                </div>

                                <!-- Quantity Control -->
                                <div class="col-md-4">
                                    <div class="input-group">
                                        <button type="button" class="btn btn-outline-secondary" onclick="updateQuantity('<%= item.ProductID %>', -1)">-</button>
                                        <input type="number" class="form-control text-center"style="width: 30px;" name="quantities[<%= item.ProductID %>]" id="quantity-<%= item.ProductID %>" value="<%= item.Quantity %>" min="1" onchange="updateTotalPrice('<%= item.ProductID %>')">
                                        <button type="button" class="btn btn-outline-secondary" onclick="updateQuantity('<%= item.ProductID %>', 1)">+</button>
                                    </div>
                                </div>
                                <!-- Select for Checkout -->               
                            </div>
                        </div>
                    </div>
                </div>
            <% }) %>
        </div>

        <div class="text-right">
            <button type="submit" class="btn btn-success">Checkout Selected</button>
        </div>
    </form>
    <div class="text-right">
    <!-- Continue shopping button -->
    <a href="/homepage/<%= userId %>" class="btn btn-secondary mt-1">Continue Shopping</a>
</div></div>
<br>
<script>
    function updateTotalPrice(item) {
        const quantityInput = document.getElementById(`quantity-${item}`);
        const totalCell = document.getElementById(`total-${item}`);
        const unitPrice = parseFloat(document.getElementById(`price-${item}`).dataset.unitPrice);

        const quantity = parseInt(quantityInput.value);
        const totalPrice = (quantity * unitPrice).toFixed(2);
        totalCell.innerText = totalPrice;
    }

    function logSelectedItems() {
        const checkboxes = document.querySelectorAll('input[name="selectedItems"]:checked');
        const selectedValues = Array.from(checkboxes).map(checkbox => checkbox.value);
        
        if (selectedValues.length === 0) {
            alert('No products selected for checkout. Please select at least one product.');
            return false; // Prevent form submission
        }

        // Add a hidden input to store selected product IDs for the server
        const selectedInput = document.createElement('input');
        selectedInput.type = 'hidden';
        selectedInput.name = 'selectedProductIds';
        selectedInput.value = JSON.stringify(selectedValues);
        document.forms[0].appendChild(selectedInput);

        return true; // Allow form submission
    }

    function updateQuantity(ProductID, change) {
        const quantityInput = document.getElementById(`quantity-${ProductID}`);
        let currentQuantity = parseInt(quantityInput.value);
        currentQuantity = Math.max(1, currentQuantity + change); // Ensure quantity doesn't go below 1
        quantityInput.value = currentQuantity;
        updateTotalPrice(ProductID); // Update total price for this item
    }
</script>
<!-- Footer Section Begin -->
<footer class="footer spad">
    <div class="container-fluid pl-5 pr-5">
        <div class="row">
            <div class="col-lg-3 col-md-5 col-sm-5 pl-5">
                <div class="footer__about">
                    <div class="footer__about__logo">
                       <img src="/img/logo.png" style="border-radius: 50px; width: 70px;" alt="">
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-1 col-sm-1 pl-1">
                <div class="footer__about">
                    <ul>
                        <li>Address: Calapan City, Oriental Mindoro</li>
                        <li>Phone: +65 11.188.888</li>
                        <li>Email: hardware@gmail.com</li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-2 col-md-1 col-sm-1 offset-lg-1">
                <div class="footer__widget">
                    <h6>Useful Links</h6>
                    <ul>
                        <li><a href="/about">About Us</a></li>
                        <li><a href="/contact">Contact</a></li>
                </div>
            </div>
            <div class="col-lg-2 col-md-6 pr-1">
                <div class="footer__widget">
                    <h6>Join Our Newsletter Now</h6>
                    <p>Get E-mail updates about our latest shop and special offers.</p>
                    <div class="footer__widget__social">
                        <a href="#"><i class="fa fa-facebook"></i></a>
                        <a href="#"><i class="fa fa-instagram"></i></a>
                        <a href="#"><i class="fa fa-twitter"></i></a>
                        <a href="#"><i class="fa fa-pinterest"></i></a>
                    </div>
                </div>
            </div>
        </div>
                <div class="footer__copyright">
                        <p style="text-align: center;">
                            Copyright &copy;<script>document.write(new Date().getFullYear());</script> 
                            All rights reserved | This ecommerce is made with 
                            <i class="fa fa-heart" aria-hidden="true"></i> 
                        </p>
                    </div>
    </div>
</footer>
<!-- Footer Section End -->
</body>
</html>